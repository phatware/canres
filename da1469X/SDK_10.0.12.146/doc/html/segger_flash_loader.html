<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>SmartSnippets DA1469x SDK: Segger Flash loader</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SmartSnippets DA1469x SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Board&#160;and&#160;Applications&#160;General&#160;Info</span></a></li>
      <li><a href="modules.html"><span>SDK&#160;Architecture</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Segger Flash loader </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Introduction</h2>
<p>This project is used to generate a flash loader according to SEGGER's Open Flashloader framework.</p>
<p>The loader allows programming the flash memory of the device using SEGGER's J-link SW tools, instead of using the flash programming tools provided by the SDK (cli_programmer etc.).</p>
<p>It is therefore required for using the <code>QSPI_DA1469x_segger_flasher</code> Debug launcher in SmartSnippets Studio (which - in contrary to the other provided QSPI launcher - also programs the flash with the new image, by using J-Link GDBServer) and it is also needed in case of directly using J-Link DLL based applications externally (e.g. J-Flash).</p>
<p>In order to build an application capable to be flashed with the Segger Flash Loader, it is necessary to define <code>dg_configUSE_SEGGER_FLASH_LOADER=1</code>. Otherwise the binary file will not include the corresponding product headers, image headers etc, causing the booter to get stuck and the application will not boot.</p>
<p>So, provided that the application has been built properly, the user can then use the <code>QSPI_DA1469x_segger_flasher</code> launcher in order to flash it and start a debug session.</p>
<p>In the latest versions, the J-Link SW tools come with built-in support for the different DA1469x device variants. So, unless using an older J-Link version, or unless a custom device implementation/variant is used which requires a different flash loader, the following sections are not needed.</p>
<p>It should also be noted that, in case of creating a custom flash loader, the performance (with respect to the speed of the flash programming process) may not be the same.</p>
<h2>Setting up the Segger Flash loader</h2>
<p>The project provides two build configurations:</p>
<ul>
<li>The <code>Debug_RAM</code> build configuration allows to debug the flash algorithm during development. The configuration includes a <code>main.c</code> file containing the typical function call order, executed by the J-Link DLL during flash programming. It behaves as a typical RAM build configuration.</li>
<li>The <code>Release</code> build configuration does not allow debugging, yet it is the one that creates the actual <code>*.elf</code> file of the loader and also copies it under <code>{workspace_loc}/binaries/da1469x/qflash</code>. This is basically the elf file that is referenced from within the JLinkDevices.xml file as "Loader".</li>
</ul>
<p>Thus, the following steps should be followed for generating the Segger flash loader .elf file (steps 2 - 3 are useful just for validating that everything has been configured properly):</p>
<ol type="1">
<li>Compile the Release build configuration of the corresponding device.</li>
<li>Make sure that the <code>segger_flash_loader.elf</code> file has been built under the <code>{workspace_loc}/binaries/da1469x/qflash/</code> path.</li>
<li>Make sure that the valid XML Tags and Attributes have been added to the <code>{workspace_loc}/config/segger/DA1469x/JLinkDevices.xml</code> so that the SEGGER tools can use the <code>segger_flash_loader.elf</code> properly.</li>
</ol>
<h2>Integrating the Segger flash launcher in the SDK</h2>
<p>The QSPI_DA1469x_segger_flasher launcher uses by default J-Link's built-in flash loader.</p>
<p>In case using a custom segger flash loader (using this project) is required, the user should open the configuration settings for the <code>QSPI_DA1469x_segger_flasher</code> debug launcher, go to the 'Debugger' tab and set <code>Device name</code> to 'DA1469x' (instead of 'DA14699').</p>
<p>For easier maintenance, the SDK integrates its own <code>JLinkDevices.xml</code> using the J-Link command <code>-JLinkDevicesXMLPath &lt;path to JLinkDevices.xml&gt;</code> according to <a href="https://forum.segger.com/index.php/Thread/4209-Add-a-new-flash-device-to-the-JLInkDevices-database/?postID=15141#post15141">SEGGER's suggestion</a>.</p>
<p>To have a better understanding how the JLinkDevices.xml is integrated by the launcher, open the <code>Debugger</code> Tab of <code>QSPI_DA1469x_segger_flasher</code> and have a look at the field <code>Other options</code> where the next attribute is included:</p>
<p><code>-JLinkDevicesXMLPath ${workspace_loc}/config/segger/DA1469x/JLinkDevices.xml</code></p>
<p>Note that the J-Link DLL first searches the xml files for an entry that matches the Device name. If there isn't such an entry, then it searches in its internal database. Thus, even in case of an officially supported device, such as DA14699, it is possible (using the xml file) to override the internal flash loader to be used and use a custom flash loader instead. This can be done by modifying the <code>Name</code> attribute for xml as follows:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;DataBase&gt;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &lt;Device&gt;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &lt;ChipInfo Vendor=&quot;Dialog Semiconductor&quot; Name=&quot;DA14699&quot; WorkRAMAddr=&quot;0x810000&quot; WorkRAMSize=&quot;0x10000&quot; Core=&quot;JLINK_CORE_CORTEX_M33&quot; /&gt;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    &lt;FlashBankInfo Name=&quot;QSPI Flash&quot; BaseAddr=&quot;0x16000000&quot; MaxSize=&quot;0x2000000&quot; Loader=&quot;../../../binaries/da1469x/qflash/segger_flash_loader.elf&quot; LoaderType=&quot;FLASH_ALGO_TYPE_OPEN&quot; /&gt;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  &lt;/Device&gt;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;&lt;/DataBase&gt;</div>
</div><!-- fragment --><p>This way, the <code>QSPI_DA1469x_segger_flasher</code> launcher will actually use the custom loader instead of the built-in one.</p>
<p>For more info, please refer to [Open Flashloader wiki page](<a href="https://wiki.segger.com/Open_Flashloader">https://wiki.segger.com/Open_Flashloader</a>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jul 15 2022 14:13:47 for SmartSnippets DA1469x SDK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
