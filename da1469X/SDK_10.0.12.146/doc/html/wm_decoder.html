<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>SmartSnippets DA1469x SDK: Dialog Haptic Waveform Memory Decoder</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SmartSnippets DA1469x SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Board&#160;and&#160;Applications&#160;General&#160;Info</span></a></li>
      <li><a href="modules.html"><span>SDK&#160;Architecture</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Dialog Haptic Waveform Memory Decoder </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>License Information</h2>
<p>This software ("Software") is owned by Dialog Semiconductor.</p>
<p>By using this Software you agree that Dialog Semiconductor retains all intellectual property and proprietary rights in and to this Software and any use, reproduction, disclosure or distribution of the Software without express written permission or a license agreement from Dialog Semiconductor is strictly prohibited. This Software is solely for use on or in conjunction with Dialog Semiconductor products.</p>
<p>EXCEPT AS OTHERWISE PROVIDED IN A LICENSE AGREEMENT BETWEEN THE PARTIES OR AS REQUIRED BY LAW, THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. EXCEPT AS OTHERWISE PROVIDED IN A LICENSE AGREEMENT BETWEEN THE PARTIES OR BY LAW, IN NO EVENT SHALL DIALOG SEMICONDUCTOR BE LIABLE FOR ANY DIRECT, SPECIAL, INDIRECT, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THE SOFTWARE.</p>
<h2>Overview</h2>
<p>The Haptic Waveform Memory Decoder provides functionality for the storage and playback of haptic waveform patterns.</p>
<p>It is designed to replicate the Waveform Memory playback functionality available on the DA7280 Haptic Driver. Please refer to the DA7280 datasheet for further details.</p>
<h2>API Usage</h2>
<h3>Initialization</h3>
<p>An instance of the <code>wm_decoder</code> module structure must be instantiated, either statically or on the heap, and must be maintained for the life-cycle of haptics processing.</p>
<p>Before Waveform Memory Decoder module processing can be performed, its module structure must be initialized by calling the <code><a class="el" href="group___w_m___d_e_c_o_d_e_r.html#ga1b723cb576a4562b3b1d407c2b7f2454">wm_decoder_init()</a></code> function.</p>
<p>The parameters of this function are as follows:</p><ul>
<li><code>decoder</code>: Pointer to the instance of the <code>wm_decoder</code> module structure to be initialized.</li>
<li><code>wm_data</code>: Pointer to the waveform memory buffer.</li>
<li><code>ACCELERATION_EN</code>: Indicates whether or not the waveforms are signed.</li>
<li><code>FREQ_WAVEFORM_TIMEBASE</code>: Time base of waveforms in <code>wm_data</code>.</li>
</ul>
<p>The <code>wm_data</code> parameter references a byte array buffer in which the encoded waveform patterns are stored. The format of this buffer is as documented in the Waveform Memory section in the DA7280 datasheet although it is recommended to use the supplied Waveform Memory Editor Tool to generate this rather than attempting to encode waveforms manually. This buffer must be instantiated, either statically or on the heap, and must be maintained for the life-cycle of haptics processing. The maximum size of this array is denoted by the <code>WM_MAX_SIZE</code> macro.</p>
<p>The <code>ACCELERATION_EN</code> parameter replicates the equivalent DA7280 register behavior (see DA7280 datasheet) and indicates whether the waveforms are to be treated as unsigned (positive only) or signed (positive and negative). When set to 0 it is assumed that automatic acceleration/braking is not enabled and that the overdrive is encoded into the waveform, with braking implemented by means of negative drive levels. When set to 1, only positive drive levels are encoded and it is assumed that acceleration/braking, if required, is handled automatically by an appropriate algorithm.</p>
<p>The <code>FREQ_WAVEFORM_TIMEBASE</code> parameter also replicates equivalent DA7280 register behavior, setting the basic ‘TIMEBASE’ used by the waveform decoder patterns. When 0 the time base is 5.44ms. When set to 1 the time base is 1.36ms.</p>
<h3>Pattern Triggering</h3>
<p>The <code><a class="el" href="group___w_m___d_e_c_o_d_e_r.html#gab28651c2728497d926330f2d7b77f6b9">wm_decoder_trigger_sequence()</a></code> function is used to trigger the playback of haptic sequences. This function is designed to be called from the application layer, either directly or indirectly (i.e. via haptics adapter API).</p>
<p>The parameters of this function are as follows:</p><ul>
<li><code>decoder</code>: Pointer to the instance of the <code>wm_decoder</code> module structure.</li>
<li><code>time</code>: Current time at which the pattern is triggered.</li>
<li><code>sequence_id</code>: Sequence ID of pattern to be triggered.</li>
</ul>
<p>The current time, represented in 32-bit integer form (outlined in more detail in the section below), should be polled immediately prior to calling this function and passed to trigger function via the <code>time</code> parameter. This represents the start time of pattern playback.</p>
<p>The sequence to be played is selected by the <code>sequence_id</code> parameter. If the trigger function is called when a sequence with the same sequence ID is already playing, the current sequence is simply stopped. If called when a sequence with a different sequence ID is already playing, the current sequence will stop playing and the new sequence will start.</p>
<p>The trigger function returns the current state of the decoder. Its return value should therefore be monitored to detect errors. The return values indicate the following:</p><ul>
<li>0: Pattern triggered (or stopped) successfully.</li>
<li>1: Pattern corresponding to <code>sequence_id</code> does not exist in <code>wm_data</code> buffer.</li>
<li>2: Error decoding the pattern corresponding to <code>sequence_id</code> (probably due to corrupt <code>wm_data</code> buffer).</li>
</ul>
<h3>Pattern Playback</h3>
<p>The waveform decoder is designed to be polled asynchronously via the <code><a class="el" href="group___w_m___d_e_c_o_d_e_r.html#ga177ee6628b3f1c0963c07c7609a13384">wm_decoder_update()</a></code> function to update what the current sequence’s drive parameters should be at the current time. This function is designed to be called from the low level driver layer (via the registered call-back function).</p>
<p>The parameters of this function are as follows:</p><ul>
<li><code>decoder</code>: Pointer to the instance of the <code>wm_decoder</code> module structure.</li>
<li><code>time</code>: Current time.</li>
</ul>
<p>The current time, represented in 32-bit integer form (outlined in more detail in the section below), should be polled immediately prior to calling this function and passed to update function via the <code>time</code> parameter. The decoder uses this to calculate how much time has elapsed since the pattern was triggered.</p>
<p>The update function updates the state of decoder according to how much time has elapsed since the last time the function was called or a pattern triggered. It iterates through the frames, snippets and piecewise linear (PWL) segments that make up current sequence until it finds where is should be according to the elapsed time and calculates the associated drive parameters accordingly.</p>
<p>After calling the <code><a class="el" href="group___w_m___d_e_c_o_d_e_r.html#ga177ee6628b3f1c0963c07c7609a13384">wm_decoder_update()</a></code> function, the updated <code>frequency</code> and <code>amplitude</code> parameters can be read from the <code>wm_decoder</code> structure. These should be used to configure the driver interface for the next half period.</p>
<h2>Timing</h2>
<p>The timing of the waveform decoder is designed to be derived more or less directly from a hardware timer. Ideally this should be free running with a 32 bit field that is incremented every CPU clock cycle (or derivative thereof) and overflows when it reaches it’s maximum value. This 32 bit timer value should be polled immediately before being passed (in raw form) to the <code><a class="el" href="group___w_m___d_e_c_o_d_e_r.html#gab28651c2728497d926330f2d7b77f6b9">wm_decoder_trigger_sequence()</a></code> and <code><a class="el" href="group___w_m___d_e_c_o_d_e_r.html#ga177ee6628b3f1c0963c07c7609a13384">wm_decoder_update()</a></code> functions.</p>
<p>The decoder internally scales this 32 bit timer value to the 1.36ms time base used by DA7280 using the <code>TIMER_DIV_SHIFT</code> compile time setting. <code>TIMER_DIV_SHIFT</code> must be set according to the CPU clock speed setting that is in use while sequences are in operation, such that the CPU clock period is scaled up to the 1.36ms time base via a power of two multiplier. In other words:</p>
<blockquote class="doxtable">
<p>2 ^ TIMER_DIV_SHIFT / fc = 1.36ms</p>
</blockquote>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jul 15 2022 14:13:47 for SmartSnippets DA1469x SDK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
